<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <script>
      window.onerror = function (msg, url, line, col, error) {
        // Ignore ResizeObserver loop limit exceeded
        if (msg.includes("ResizeObserver loop limit exceeded")) return;

        var div = document.createElement("div");
        div.style.cssText =
          "position:fixed;top:0;left:0;right:0;background:rgba(255,0,0,0.9);color:white;padding:20px;z-index:9999;white-space:pre-wrap;font-family:monospace;font-size:12px;";
        div.textContent =
          "JS Error: " +
          msg +
          "\n" +
          (url || "").split("/").pop() +
          ":" +
          line +
          ":" +
          col +
          "\n" +
          (error ? error.stack : "");
        document.body.appendChild(div);
      };
    </script>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Climber Gym Guide</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Gym Guide" />
    <link rel="apple-touch-icon" href="dumbbell.svg" />
    <link rel="icon" href="dumbbell.svg" type="image/svg+xml" />
    <link rel="manifest" href="manifest.json" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script>
      window.react = window.React;
    </script>
    <script
      crossorigin
      src="https://unpkg.com/@babel/standalone/babel.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/lucide-react@0.344.0/dist/umd/lucide-react.js"
    ></script>
    <style>
      body {
        -webkit-tap-highlight-color: transparent;
      }
      /* Hide scrollbar for Chrome, Safari and Opera */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      /* Hide scrollbar for IE, Edge and Firefox */
      .no-scrollbar {
        -ms-overflow-style: none; /* IE and Edge */
        scrollbar-width: none; /* Firefox */
      }
    </style>
  </head>
  <body class="bg-slate-950 text-white min-h-screen">
    <div id="root"></div>
    <script type="text/babel">
      const { useState, useEffect } = React;
      const {
        Activity,
        ChevronRight,
        Calendar,
        Trophy,
        Info,
        Check,
        Plus,
        Minus,
        Shuffle,
        Sparkles,
        Zap,
        Flame,
        Dumbbell,
        RotateCcw,
        Play,
        Pause,
        Square,
        Timer,
        MoreVertical,
        X,
        Plane,
      } = LucideReact;

      // --- SOUND UTILS ---
      const playBeep = () => {
        try {
          const AudioContext = window.AudioContext || window.webkitAudioContext;
          if (!AudioContext) return;

          const ctx = new AudioContext();
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();

          osc.connect(gain);
          gain.connect(ctx.destination);

          osc.type = "sine";
          osc.frequency.setValueAtTime(880, ctx.currentTime);
          osc.frequency.exponentialRampToValueAtTime(
            440,
            ctx.currentTime + 0.5
          );

          gain.gain.setValueAtTime(0.3, ctx.currentTime);
          gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);

          osc.start();
          osc.stop(ctx.currentTime + 0.5);
        } catch (e) {
          console.error("Audio play failed", e);
        }
      };

      // --- DATA & CUES ---

      const EXERCISE_LIBRARY = {
        // --- PREHAB (Fixed Daily Pairs) ---
        "scap-retract": {
          name: "Scapular Retractions",
          type: "Prehab",
          muscle: "Scapula",
          how: "Hang with straight arms. Pull shoulder blades down/back (no elbow bend).",
          why: "Teaches safe pulling mechanics.",
          defaultReps: 15,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "band-pull-aparts",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Back-flyes-with-resistance-bands-2.png",
        },
        "band-pull-aparts": {
          name: "Band Pull-Aparts",
          type: "Prehab",
          muscle: "Rear Delt",
          how: "Hold band, pull apart to chest keeping arms straight.",
          why: "Great alternative if no bar available.",
          defaultReps: 15,
          defaultWeight: 0,
          unit: "band",
          alt: "scap-retract",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Back-flyes-with-resistance-bands-2.png",
        },
        "ext-rot": {
          name: "External Rotations",
          type: "Prehab",
          muscle: "Rotator Cuff",
          how: "Elbow tucked to side, rotate forearm outward.",
          why: "Strengthens rotator cuff.",
          defaultReps: 15,
          defaultWeight: 12.5,
          unit: "kg",
          alt: "face-pulls",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Cable-internal-rotation-2.png",
        },
        "face-pulls": {
          name: "Face Pulls",
          type: "Prehab",
          muscle: "Rear Delt",
          how: "Pull rope to forehead, leading with hands.",
          why: "Dynamic rotator cuff work.",
          defaultReps: 15,
          defaultWeight: 10,
          unit: "kg",
          alt: "ext-rot",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Rear-deltoid-row-2.png",
        },
        ytw: {
          name: "Y-T-W Raises",
          type: "Prehab",
          muscle: "Lower Trap",
          how: "Lying face-down, lift arms into Y → T → W shapes.",
          why: "Rebalances shoulder muscles.",
          defaultReps: 10,
          defaultWeight: 10,
          unit: "kg",
          alt: "prone-swimmers",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Supermans-2.png",
        },
        "prone-swimmers": {
          name: "Prone Swimmers",
          type: "Mobility",
          muscle: "Shoulder",
          how: "Lie face down, move arms from overhead to lower back (handcuff).",
          why: "Active range of motion.",
          defaultReps: 8,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "ytw",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Supermans-2.png",
        },
        "wall-slide": {
          name: "Wall Slides",
          type: "Prehab",
          muscle: "Mobility",
          how: "Back + forearms against wall. Slide up/down maintaining contact.",
          why: "Restores shoulder mobility.",
          defaultReps: 15,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "doorway-stretch",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Shoulder-press-machine-2.png",
        },
        "doorway-stretch": {
          name: "Doorway Stretch",
          type: "Mobility",
          muscle: "Pec Minor",
          how: "Forearms on door frame, lean forward.",
          why: "Passive stretch option.",
          defaultReps: 30,
          defaultWeight: 0,
          unit: "seconds",
          isTime: true,
          alt: "wall-slide",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Butterfly-machine-2.png",
        },

        // --- STRENGTH / WORKOUT LIBRARY ---

        // Push Patterns
        ohp: {
          name: "Overhead Press",
          type: "Push",
          muscle: "Shoulders",
          how: "Strict press bar overhead, core tight.",
          why: "Vertical pushing strength.",
          defaultReps: 15,
          defaultWeight: 10,
          unit: "kg",
          alt: "landmine-press",
          rest: 120,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Seated-military-shoulder-press-2.png",
        },
        "landmine-press": {
          name: "Landmine Press",
          type: "Push",
          muscle: "Shoulders",
          how: "Press bar end with one arm, leaning slightly.",
          why: "Shoulder friendly pressing.",
          defaultReps: 10,
          defaultWeight: 15,
          unit: "kg",
          alt: "ohp",
          rest: 90,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/One-arm-shoulder-press-2.png",
        },
        "bench-press": {
          name: "DB Bench Press",
          type: "Push",
          muscle: "Chest",
          how: "Flat bench, dumbbells at 45 degree angle.",
          why: "Horizontal pushing power.",
          defaultReps: 10,
          defaultWeight: 20,
          unit: "kg",
          alt: "floor-press",
          rest: 120,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Dumbbell-bench-press-2.png",
        },
        "floor-press": {
          name: "Floor Press",
          type: "Push",
          muscle: "Triceps/Chest",
          how: "Lie on floor, press weights until elbows touch ground.",
          why: "Limits range of motion to protect shoulders.",
          defaultReps: 15,
          defaultWeight: 12.5,
          unit: "kg",
          alt: "bench-press",
          rest: 90,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/One-arm-floor-press-2.png",
        },
        dips: {
          name: "Weighted Dips",
          type: "Push",
          muscle: "Triceps",
          how: "Keep chest slightly forward, dip to 90 degrees.",
          why: "Antagonist to climbing pulling muscles.",
          defaultReps: 8,
          defaultWeight: 10,
          unit: "kg",
          alt: "pushups",
          rest: 120,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Tricep-dips-1.gif",
        },
        pushups: {
          name: "Weighted Pushups",
          type: "Push",
          muscle: "Core/Chest",
          how: "Plate on back, strict form.",
          why: "Core integrated pushing.",
          defaultReps: 15,
          defaultWeight: 10,
          unit: "kg",
          alt: "dips",
          rest: 90,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Push-ups-1.png",
        },

        // Pull Patterns
        pullups: {
          name: "Pull Ups",
          type: "Pull",
          muscle: "Lats (Supported)",
          how: "Full ROM, chest to bar.",
          why: "Primary climbing strength.",
          defaultReps: 12,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "lat-pulldown",
          rest: 120,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Chin-ups-1.png",
        },
        "lat-pulldown": {
          name: "Lat Pulldown",
          type: "Pull",
          muscle: "Lats",
          how: "Wide grip, pull to collarbone.",
          why: "Volume for back muscles.",
          defaultReps: 10,
          defaultWeight: 50,
          unit: "kg",
          alt: "pullups",
          rest: 90,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Wide-grip-lat-pull-down-1.gif",
        },
        "db-row": {
          name: "DB Rows",
          type: "Pull",
          muscle: "Mid-Back",
          how: "Hand on bench, pull weight to hip.",
          why: "Horizontal pulling balance.",
          defaultReps: 15,
          defaultWeight: 12.5,
          unit: "kg",
          alt: "inv-row",
          rest: 90,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Bent-over-rear-delt-row-with-head-on-bench-1.png",
        },
        "inv-row": {
          name: "Inverted Rows",
          type: "Pull",
          muscle: "Rear Delt",
          how: "Hang under bar, pull chest to bar.",
          why: "Bodyweight horizontal pull.",
          defaultReps: 12,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "db-row",
          rest: 90,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Body-row-1.png",
        },

        // Leg Patterns
        "goblet-squat": {
          name: "Goblet Squat",
          type: "Legs",
          muscle: "Quads",
          how: "Hold weight at chest, deep squat.",
          why: "Leg strength without spinal loading.",
          defaultReps: 10,
          defaultWeight: 10,
          unit: "kg",
          alt: "lunge",
          rest: 120,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Squats-1.png",
        },
        lunge: {
          name: "Walking Lunges",
          type: "Legs",
          muscle: "Glutes",
          how: "Step forward, back knee kisses ground.",
          why: "Unilateral leg strength.",
          defaultReps: 10,
          defaultWeight: 10,
          unit: "kg",
          alt: "goblet-squat",
          rest: 90,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Walking-lunges-1.png",
        },
        rdl: {
          name: "Romanian Deadlift",
          type: "Legs",
          muscle: "Hamstrings",
          how: "Hinge at hips, slight knee bend, flat back.",
          why: "Posterior chain protection.",
          defaultReps: 10,
          defaultWeight: 60,
          unit: "kg",
          alt: "kb-swing",
          rest: 120,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Romanian-deadlift-1.png",
        },
        "kb-swing": {
          name: "Kettlebell Swings",
          type: "Legs",
          muscle: "Hips",
          how: "Explosive hip hinge.",
          why: "Dynamic posterior power.",
          defaultReps: 20,
          defaultWeight: 24,
          unit: "kg",
          alt: "rdl",
          rest: 90,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/One-arm-snatch-1.gif",
        },
        cossack: {
          name: "Cossack Squat",
          type: "Legs",
          muscle: "Mobility",
          how: "Side lunge, keep other leg straight, toe up.",
          why: "Hip mobility for high steps.",
          defaultReps: 6,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "lat-lunge",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Side-split-squats-1-1024x600.png",
        },
        "lat-lunge": {
          name: "Lateral Lunge",
          type: "Legs",
          muscle: "Adductors",
          how: "Step to side, sink hips back.",
          why: "Groin strength.",
          defaultReps: 10,
          defaultWeight: 12,
          unit: "kg",
          alt: "cossack",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Side-split-squats-1-1024x600.png",
        },

        // Core
        "leg-raise": {
          name: "Hanging Leg Raise",
          type: "Core",
          muscle: "Abs",
          how: "Hang from bar, lift toes to bar.",
          why: "Core tension on the wall.",
          defaultReps: 8,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "v-up",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Leg-raises-1.png",
        },
        "v-up": {
          name: "V-Ups",
          type: "Core",
          muscle: "Abs",
          how: "Snap body into V shape on floor.",
          why: "Dynamic core.",
          defaultReps: 8,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "leg-raise",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Leg-lift-1.png",
        },
        pallof: {
          name: "Pallof Press",
          type: "Core",
          muscle: "Obliques",
          how: "Resist rotation from cable/band.",
          why: "Anti-rotation stability.",
          defaultReps: 10,
          defaultWeight: 15,
          unit: "kg",
          alt: "side-plank",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Cable-internal-rotation-1.png",
        },
        "side-plank": {
          name: "Side Plank",
          type: "Core",
          muscle: "Obliques",
          how: "Hold straight line.",
          why: "Lateral stability.",
          defaultReps: 30,
          defaultWeight: 0,
          unit: "seconds",
          isTime: true,
          alt: "pallof",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Side-plank-1.png",
        },

        // --- TRAVEL / BODYWEIGHT LIBRARY ---
        "sit-up": {
          name: "Sit-up",
          type: "Core",
          muscle: "Abs",
          how: "Lie on floor, knees bent. Lift torso to V shape.",
          why: "Core strength.",
          defaultReps: 12,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "v-up",
          rest: 0,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Sit-up-1.png",
        },
        "press-up": {
          name: "Press-up",
          type: "Push",
          muscle: "Chest/Triceps",
          how: "Straight body, chest to floor, drive up.",
          why: "Horizontal pushing.",
          defaultReps: 12,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "pushups",
          rest: 0,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Push-ups-1.png",
        },
        "spider-crawl": {
          name: "Spider Crawl",
          type: "Core",
          muscle: "Full Body",
          how: "Press-up position. Bring knee to elbow. Alternate.",
          why: "Dynamic core and mobility.",
          defaultReps: 20,
          defaultWeight: 0,
          unit: "reps",
          alt: "mountain-climbers",
          rest: 0,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Spiderman-push-up-2.png",
        },
        "bodyweight-squat": {
          name: "Bodyweight Squat",
          type: "Legs",
          muscle: "Quads",
          how: "Deep squat, back straight.",
          why: "Leg endurance.",
          defaultReps: 20,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "goblet-squat",
          rest: 0,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Squats-1.png",
        },
        "pike-press-up": {
          name: "Pike Press-up",
          type: "Push",
          muscle: "Shoulders",
          how: "V-shape body. Lower head to floor.",
          why: "Vertical pushing without weights.",
          defaultReps: 12,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "ohp",
          rest: 0,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Pike-push-up-1.png",
        },
        "pistol-squat": {
          name: "Pistol Squat",
          type: "Legs",
          muscle: "Quads/Balance",
          how: "One leg squat. Other leg straight forward.",
          why: "Unilateral strength and balance.",
          defaultReps: 8,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "lunge",
          rest: 60,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Pistol-squats-1.png",
        },
        "bodyweight-lunge": {
          name: "Walking Lunge (BW)",
          type: "Legs",
          muscle: "Glutes/Quads",
          how: "Lunge forward, trailing knee low. Push off heel.",
          why: "Unilateral leg strength.",
          defaultReps: 20,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "pistol-squat",
          rest: 0,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Walking-lunges-1.png",
        },
        "glute-bridge": {
          name: "Glute Bridge",
          type: "Legs",
          muscle: "Glutes/Hams",
          how: "Lie on back, knees bent. Lift hips to ceiling.",
          why: "Posterior chain activation.",
          defaultReps: 15,
          defaultWeight: 0,
          unit: "bodyweight",
          alt: "bodyweight-squat",
          rest: 0,
          image:
            "https://commons.wikimedia.org/wiki/Special:FilePath/Supermans-2.png",
        },
      };

      // --- STRATEGY: 4 PAIRS DAILY ---
      // Pairs 1 & 2: ALWAYS PREHAB (Fixed)
      // Pairs 3 & 4: SYNERGISTIC SPLIT (Variable)

      const FIXED_PREHAB = [
        { pairId: "pre1", exercises: ["scap-retract", "ext-rot"], sets: 3 },
        { pairId: "pre2", exercises: ["ytw", "wall-slide"], sets: 3 },
      ];

      const WEEKLY_PLAN = {
        Monday: [
          ...FIXED_PREHAB,
          // Focus: Vertical Push + Squat (Shoulder/Legs Synergy)
          { pairId: "m-w1", exercises: ["ohp", "goblet-squat"], sets: 3 },
          // Focus: Accessory Push + Core
          {
            pairId: "m-w2",
            exercises: ["landmine-press", "leg-raise"],
            sets: 3,
          },
        ],
        Tuesday: [
          ...FIXED_PREHAB,
          // Focus: Vertical Pull + Unilateral Legs (Opposing forces)
          { pairId: "t-w1", exercises: ["pullups", "lunge"], sets: 3 },
          // Focus: Mid-back + Anti-Rotation
          { pairId: "t-w2", exercises: ["db-row", "pallof"], sets: 3 },
        ],
        Wednesday: [
          ...FIXED_PREHAB,
          // Focus: Horizontal Push + Hinge (Chest/Hamstrings)
          { pairId: "w-w1", exercises: ["bench-press", "rdl"], sets: 3 },
          // Focus: Triceps + Mobility
          { pairId: "w-w2", exercises: ["dips", "cossack"], sets: 3 },
        ],
        Thursday: [
          ...FIXED_PREHAB,
          // Focus: Explosive Hinge + Horizontal Pull (Power Day)
          { pairId: "th-w1", exercises: ["kb-swing", "inv-row"], sets: 3 },
          // Focus: Core + Stabilizers
          { pairId: "th-w2", exercises: ["pushups", "side-plank"], sets: 3 },
        ],
        Friday: [
          ...FIXED_PREHAB,
          // Focus: Volume Pull + Squat Variation
          {
            pairId: "f-w1",
            exercises: ["lat-pulldown", "goblet-squat"],
            sets: 3,
          },
          // Focus: Arm Pump + Abs (Fun Friday)
          { pairId: "f-w2", exercises: ["floor-press", "v-up"], sets: 3 },
        ],
      };

      const TRAVEL_PLAN = [
        {
          pairId: "travel-1",
          exercises: ["bodyweight-lunge", "sit-up"],
          sets: 3,
        },
        {
          pairId: "travel-2",
          exercises: ["press-up", "spider-crawl"],
          sets: 3,
        },
        {
          pairId: "travel-3",
          exercises: ["bodyweight-squat", "pike-press-up"],
          sets: 3,
        },
        {
          pairId: "travel-4",
          exercises: ["pistol-squat", "glute-bridge"],
          sets: 3,
        },
      ];

      const ExerciseCard = ({
        exerciseId,
        logData,
        onInputChange,
        isComplete,
        onSwap,
        isSwapped,
      }) => {
        const ex = EXERCISE_LIBRARY[exerciseId];
        if (!ex) return null;

        // Recommendations
        const recommendedWeight = ex.defaultWeight;
        const recommendedReps = ex.defaultReps;

        const currentWeight =
          logData?.weight !== undefined ? logData.weight : recommendedWeight;
        const currentReps =
          logData?.reps !== undefined ? logData.reps : recommendedReps;

        const adjustWeight = (delta) => {
          const newVal = Math.max(0, Number(currentWeight) + delta);
          onInputChange(exerciseId, "weight", newVal);
        };

        const adjustReps = (delta) => {
          const newVal = Math.max(0, Number(currentReps) + delta);
          onInputChange(exerciseId, "reps", newVal);
        };

        // Timer Logic
        const [timerActive, setTimerActive] = useState(false);
        const [timeLeft, setTimeLeft] = useState(null);

        useEffect(() => {
          if (ex.isTime && !timerActive) {
            setTimeLeft(currentReps);
          }
        }, [currentReps, ex.isTime, timerActive]);

        useEffect(() => {
          let interval = null;
          if (timerActive && timeLeft > 0) {
            interval = setInterval(() => {
              setTimeLeft((t) => {
                if (t <= 1) {
                  playBeep();
                  setTimerActive(false);
                  return 0;
                }
                return t - 1;
              });
            }, 1000);
          }
          return () => clearInterval(interval);
        }, [timerActive, timeLeft]);

        const toggleTimer = () => {
          if (timeLeft === 0) setTimeLeft(currentReps);
          setTimerActive(!timerActive);
        };

        const resetTimer = () => {
          setTimerActive(false);
          setTimeLeft(currentReps);
        };

        return (
          <div
            className={`
            rounded-3xl p-5 flex flex-col gap-4 shadow-xl border-2 transition-all duration-500 relative overflow-hidden group animate-in slide-in-from-bottom-4
            ${
              isComplete
                ? "bg-gradient-to-br from-indigo-900/40 to-emerald-900/40 border-emerald-500/30"
                : "bg-gradient-to-br from-indigo-950 to-slate-900 border-indigo-500/20 hover:border-indigo-400/40"
            }
            `}
          >
            {/* Card Glow Effect */}
            <div className="absolute -top-10 -right-10 w-32 h-32 bg-indigo-500/10 blur-3xl rounded-full group-hover:bg-indigo-400/20 transition-all"></div>

            {/* Image Header */}
            <div className="h-48 -mx-5 -mt-5 mb-4 relative overflow-hidden rounded-t-3xl bg-black px-4">
              <img
                src={ex.image}
                alt={ex.name}
                className="w-full h-full object-contain object-center invert opacity-90 group-hover:opacity-100 transition-all duration-500"
              />
              <div className="absolute inset-0 bg-gradient-to-t from-slate-950 to-transparent"></div>

              {/* Timer Overlay for Time-based exercises */}
              {ex.isTime && (
                <div className="absolute bottom-4 right-4 flex gap-2 z-20">
                  <button
                    onClick={toggleTimer}
                    className={`p-3 rounded-full backdrop-blur-md border border-white/10 shadow-lg transition-all active:scale-90 ${
                      timerActive
                        ? "bg-amber-500/80 text-white"
                        : "bg-indigo-600/80 text-white"
                    }`}
                  >
                    {timerActive ? (
                      <Pause size={24} fill="currentColor" />
                    ) : (
                      <Play size={24} fill="currentColor" />
                    )}
                  </button>
                  <button
                    onClick={resetTimer}
                    className="p-3 rounded-full bg-slate-800/80 backdrop-blur-md text-white border border-white/10 shadow-lg transition-all active:scale-90 hover:bg-slate-700"
                  >
                    <RotateCcw size={24} />
                  </button>
                </div>
              )}

              {ex.isTime && (
                <div className="absolute bottom-4 left-4 z-20">
                  <span
                    className={`text-4xl font-black font-mono tabular-nums drop-shadow-lg ${
                      timeLeft <= 5 && timeLeft > 0
                        ? "text-red-500 animate-pulse"
                        : "text-white"
                    }`}
                  >
                    {timeLeft}s
                  </span>
                </div>
              )}
            </div>

            {/* Header */}
            <div className="z-10 flex justify-between items-start">
              <div>
                <div className="flex items-center gap-2 mb-1">
                  <h3 className="font-black text-xl text-white tracking-tight">
                    {ex.name}
                  </h3>
                  {isSwapped && (
                    <span className="bg-indigo-500 text-white text-[10px] px-1.5 py-0.5 rounded font-bold animate-pulse">
                      ALT
                    </span>
                  )}
                </div>
                <span className="text-xs font-bold text-indigo-300 bg-indigo-950/50 px-2 py-1 rounded-lg border border-indigo-500/20">
                  {ex.muscle}
                </span>
              </div>

              {/* Swap Button */}
              <button
                onClick={() => onSwap(exerciseId)}
                className="p-2 rounded-full bg-slate-800/50 text-slate-400 hover:text-white hover:bg-indigo-600 hover:rotate-180 transition-all duration-500 active:scale-90"
                title="Swap Exercise"
              >
                <Shuffle size={16} />
              </button>
            </div>

            {/* Cues */}
            <div className="z-10 bg-slate-950/40 rounded-2xl p-4 border border-white/5 backdrop-blur-sm shadow-inner">
              <div className="flex gap-3 mb-2">
                <div className="w-1 h-auto bg-gradient-to-b from-indigo-500 to-indigo-700 rounded-full"></div>
                <div>
                  <p className="text-slate-200 text-sm font-medium leading-relaxed">
                    {ex.how}
                  </p>
                </div>
              </div>
              <p className="text-slate-400 text-xs pl-4 flex items-center gap-1">
                <Zap size={10} className="text-yellow-500 fill-yellow-500" />
                {ex.why}
              </p>
            </div>

            {/* Inputs */}
            <div className="z-10 grid grid-cols-2 gap-3">
              {/* Weight Control */}
              <div className="bg-slate-950/60 rounded-2xl p-3 flex flex-col items-center border border-white/5 relative group/input shadow-sm">
                <label className="text-slate-500 text-[9px] uppercase font-black tracking-widest mb-2">
                  {ex.unit === "bodyweight" ? "Added Weight" : "Load (kg)"}
                </label>
                <div className="flex items-center justify-between w-full">
                  <button
                    onClick={() => adjustWeight(-1)}
                    className="w-9 h-9 rounded-xl bg-slate-800 flex items-center justify-center text-slate-300 hover:bg-indigo-600 hover:text-white active:scale-90 transition-all shadow-md"
                  >
                    <Minus size={16} strokeWidth={3} />
                  </button>
                  <span className="text-2xl font-black text-white font-mono tabular-nums">
                    {currentWeight}
                  </span>
                  <button
                    onClick={() => adjustWeight(2.5)}
                    className="w-9 h-9 rounded-xl bg-slate-800 flex items-center justify-center text-slate-300 hover:bg-indigo-600 hover:text-white active:scale-90 transition-all shadow-md"
                  >
                    <Plus size={16} strokeWidth={3} />
                  </button>
                </div>
              </div>

              {/* Reps Control */}
              <div className="bg-slate-950/60 rounded-2xl p-3 flex flex-col items-center border border-white/5 shadow-sm">
                <label className="text-slate-500 text-[9px] uppercase font-black tracking-widest mb-2">
                  {ex.isTime ? "Seconds" : "Reps"}
                </label>
                <div className="flex items-center justify-between w-full">
                  <button
                    onClick={() => adjustReps(-1)}
                    className="w-9 h-9 rounded-xl bg-slate-800 flex items-center justify-center text-slate-300 hover:bg-indigo-600 hover:text-white active:scale-90 transition-all shadow-md"
                  >
                    <Minus size={16} strokeWidth={3} />
                  </button>
                  <span className="text-2xl font-black text-white font-mono tabular-nums">
                    {currentReps}
                  </span>
                  <button
                    onClick={() => adjustReps(1)}
                    className="w-9 h-9 rounded-xl bg-slate-800 flex items-center justify-center text-slate-300 hover:bg-indigo-600 hover:text-white active:scale-90 transition-all shadow-md"
                  >
                    <Plus size={16} strokeWidth={3} />
                  </button>
                </div>
              </div>
            </div>
          </div>
        );
      };

      const RestTimer = ({ duration, onComplete, onSkip }) => {
        const [timeLeft, setTimeLeft] = useState(duration);

        useEffect(() => {
          if (timeLeft <= 0) {
            onComplete();
            return;
          }
          const timer = setInterval(() => setTimeLeft((t) => t - 1), 1000);
          return () => clearInterval(timer);
        }, [timeLeft, onComplete]);

        const progress = ((duration - timeLeft) / duration) * 100;

        return (
          <div className="fixed inset-0 z-[60] flex items-center justify-center bg-slate-950/95 backdrop-blur-md animate-in fade-in duration-300">
            <div className="flex flex-col items-center gap-8 w-full max-w-xs">
              <div className="relative flex items-center justify-center">
                <svg className="w-64 h-64 transform -rotate-90">
                  <circle
                    cx="128"
                    cy="128"
                    r="120"
                    stroke="currentColor"
                    strokeWidth="8"
                    fill="transparent"
                    className="text-slate-800"
                  />
                  <circle
                    cx="128"
                    cy="128"
                    r="120"
                    stroke="currentColor"
                    strokeWidth="8"
                    fill="transparent"
                    className="text-indigo-500 transition-all duration-1000 ease-linear"
                    strokeDasharray={2 * Math.PI * 120}
                    strokeDashoffset={
                      2 * Math.PI * 120 * (1 - timeLeft / duration)
                    }
                    strokeLinecap="round"
                  />
                </svg>
                <div className="absolute inset-0 flex items-center justify-center flex-col">
                  <span className="text-6xl font-black font-mono tabular-nums text-white">
                    {Math.floor(timeLeft / 60)}:
                    {(timeLeft % 60).toString().padStart(2, "0")}
                  </span>
                  <span className="text-slate-400 uppercase tracking-widest text-sm mt-2 font-bold">
                    Rest
                  </span>
                </div>
              </div>

              <button
                onClick={onSkip}
                className="bg-slate-800 hover:bg-slate-700 text-white px-8 py-4 rounded-2xl font-bold transition-all active:scale-95 w-full border border-white/10"
              >
                Skip Rest
              </button>
            </div>
          </div>
        );
      };

      const UpcomingDrawer = ({
        isOpen,
        onClose,
        dailyRoutine,
        activeGroupIndex,
        getExerciseId,
        logs,
      }) => {
        if (!isOpen) return null;

        // Calculate materials
        const materials = new Set();
        const weights = new Set();

        dailyRoutine.forEach((group) => {
          group.exercises.forEach((exId) => {
            const effectiveId = getExerciseId(exId);
            const ex = EXERCISE_LIBRARY[effectiveId];

            // Get current weight for this exercise
            const log = logs && logs[effectiveId] ? logs[effectiveId] : {};
            const weightVal =
              log.weight !== undefined ? log.weight : ex.defaultWeight;

            if (ex.unit === "kg" && weightVal > 0) {
              weights.add(weightVal);
            }

            if (ex.unit === "band") materials.add("Resistance Bands");
            if (
              ex.name.toLowerCase().includes("pull up") ||
              ex.name.toLowerCase().includes("hanging")
            )
              materials.add("Pull-up Bar");
            if (ex.name.toLowerCase().includes("dip"))
              materials.add("Dip Station");
            if (ex.name.toLowerCase().includes("bench")) materials.add("Bench");
            if (
              ex.name.toLowerCase().includes("cable") ||
              ex.name.toLowerCase().includes("pallof")
            )
              materials.add("Cable Machine/Band");
          });
        });

        const sortedWeights = Array.from(weights).sort((a, b) => a - b);

        return (
          <div
            className="fixed inset-0 z-[70] bg-black/60 backdrop-blur-sm animate-in fade-in duration-200"
            onClick={onClose}
          >
            <div
              className="absolute bottom-0 left-0 right-0 bg-slate-900 rounded-t-[2rem] p-6 max-h-[85vh] overflow-y-auto animate-in slide-in-from-bottom duration-300 shadow-2xl border-t border-white/10"
              onClick={(e) => e.stopPropagation()}
            >
              <div className="w-12 h-1.5 bg-slate-700 rounded-full mx-auto mb-8" />

              {/* Materials Summary */}
              <div className="mb-8 bg-slate-800/50 rounded-2xl p-4 border border-white/5">
                <h4 className="text-sm font-bold text-indigo-400 uppercase tracking-wider mb-3 flex items-center gap-2">
                  <Info size={16} /> Needed Today
                </h4>
                <div className="flex flex-wrap gap-2">
                  {sortedWeights.map((w) => (
                    <span
                      key={w}
                      className="text-xs font-bold text-slate-900 bg-indigo-400 px-2 py-1 rounded-lg border border-indigo-500/50"
                    >
                      {w} kg
                    </span>
                  ))}
                  {Array.from(materials).map((m) => (
                    <span
                      key={m}
                      className="text-xs font-bold text-slate-300 bg-slate-700/50 px-2 py-1 rounded-lg border border-white/5"
                    >
                      {m}
                    </span>
                  ))}
                  {materials.size === 0 && weights.size === 0 && (
                    <span className="text-xs text-slate-500">
                      Bodyweight only
                    </span>
                  )}
                </div>
              </div>

              <h3 className="text-2xl font-black text-white mb-6 flex items-center gap-3">
                <Calendar size={24} className="text-indigo-400" />
                Today's Plan
              </h3>
              <div className="flex flex-col gap-6">
                {dailyRoutine.map((group, idx) => {
                  const isCompleted = idx < activeGroupIndex;
                  const isCurrent = idx === activeGroupIndex;

                  return (
                    <div
                      key={idx}
                      className={`rounded-3xl p-5 border transition-all duration-300 ${
                        isCompleted
                          ? "bg-slate-900/50 border-slate-800 opacity-60 grayscale"
                          : isCurrent
                          ? "bg-slate-800/80 border-indigo-500/30 shadow-lg shadow-indigo-500/10"
                          : "bg-slate-800/30 border-white/5"
                      }`}
                    >
                      <div className="flex items-center justify-between mb-4">
                        <div
                          className={`text-xs font-bold uppercase tracking-wider flex items-center gap-2 ${
                            isCurrent ? "text-indigo-400" : "text-slate-500"
                          }`}
                        >
                          <span
                            className={`w-2 h-2 rounded-full ${
                              isCompleted
                                ? "bg-emerald-500"
                                : isCurrent
                                ? "bg-indigo-500 animate-pulse"
                                : "bg-slate-600"
                            }`}
                          ></span>
                          Pair {idx + 1}
                        </div>
                        {isCompleted && (
                          <span className="text-emerald-500 text-xs font-bold flex items-center gap-1">
                            <Check size={12} strokeWidth={3} /> Done
                          </span>
                        )}
                      </div>
                      <div className="flex gap-4 overflow-x-auto pb-4 no-scrollbar snap-x -mx-2 px-2">
                        {group.exercises.map((exId) => {
                          const effectiveId = getExerciseId(exId);
                          const ex = EXERCISE_LIBRARY[effectiveId];
                          const log =
                            logs && logs[effectiveId] ? logs[effectiveId] : {};
                          const weight =
                            log.weight !== undefined
                              ? log.weight
                              : ex.defaultWeight;
                          const reps =
                            log.reps !== undefined ? log.reps : ex.defaultReps;
                          const totalReps = reps * group.sets;

                          return (
                            <div
                              key={exId}
                              className="flex-none w-64 bg-slate-950 rounded-2xl p-4 border border-white/5 snap-center flex flex-col gap-3 shadow-lg relative overflow-hidden"
                            >
                              {isCompleted && (
                                <div className="absolute inset-0 bg-slate-950/50 z-10 flex items-center justify-center">
                                  <Check
                                    size={48}
                                    className="text-emerald-500/50"
                                  />
                                </div>
                              )}
                              <div className="aspect-video bg-black rounded-xl overflow-hidden relative group">
                                <img
                                  src={ex.image}
                                  alt={ex.name}
                                  className="w-full h-full object-contain object-center invert opacity-80 group-hover:opacity-100 transition-opacity duration-500"
                                />
                                <div className="absolute inset-0 bg-gradient-to-t from-slate-950/80 to-transparent"></div>
                                <div className="absolute bottom-2 left-2 right-2">
                                  <span className="text-[10px] font-bold text-white bg-indigo-600/80 px-2 py-1 rounded backdrop-blur-sm">
                                    {ex.muscle}
                                  </span>
                                </div>
                              </div>
                              <div>
                                <div className="font-bold text-white text-lg leading-tight mb-1">
                                  {ex.name}
                                </div>
                                <div className="text-xs text-slate-400 font-medium flex flex-col gap-1.5 mt-2">
                                  <div className="flex items-center gap-2">
                                    <Dumbbell
                                      size={12}
                                      className="text-indigo-400"
                                    />
                                    <span className="text-slate-300">
                                      {weight > 0
                                        ? `${weight} ${ex.unit}`
                                        : "Bodyweight"}
                                    </span>
                                  </div>
                                  <div className="flex items-center gap-2">
                                    <RotateCcw
                                      size={12}
                                      className="text-emerald-400"
                                    />
                                    <span className="text-slate-300">
                                      {reps} {ex.isTime ? "s" : "reps"} ×{" "}
                                      {group.sets} sets
                                      <span className="text-slate-500 ml-1">
                                        ({totalReps} total)
                                      </span>
                                    </span>
                                  </div>
                                </div>
                              </div>
                            </div>
                          );
                        })}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        );
      };

      function ClimberGymGuide() {
        // Auto-detect day, fallback to Monday if weekend
        const getInitialDay = () => {
          const d = new Date().toLocaleDateString("en-US", { weekday: "long" });
          if (d === "Saturday" || d === "Sunday") return "Monday";
          return d;
        };

        const [currentDay, setCurrentDay] = useState(getInitialDay());

        // Load progress from local storage
        const getDayProgress = (day) => {
          try {
            const saved = JSON.parse(
              localStorage.getItem("gym-progress") || "{}"
            );
            return (
              saved[day] || {
                activeGroupIndex: 0,
                currentSet: 1,
                isComplete: false,
              }
            );
          } catch {
            return { activeGroupIndex: 0, currentSet: 1, isComplete: false };
          }
        };

        const initialProgress = getDayProgress(currentDay);
        const [activeGroupIndex, setActiveGroupIndex] = useState(
          initialProgress.activeGroupIndex
        );
        const [currentSet, setCurrentSet] = useState(
          initialProgress.currentSet
        );
        const [isComplete, setIsComplete] = useState(
          initialProgress.isComplete
        );

        // Update state when day changes
        useEffect(() => {
          const p = getDayProgress(currentDay);
          setActiveGroupIndex(p.activeGroupIndex);
          setCurrentSet(p.currentSet);
          setIsComplete(p.isComplete);
        }, [currentDay]);

        // Save progress whenever it changes
        useEffect(() => {
          try {
            const allProgress = JSON.parse(
              localStorage.getItem("gym-progress") || "{}"
            );
            const newProgress = {
              ...allProgress,
              [currentDay]: { activeGroupIndex, currentSet, isComplete },
            };
            localStorage.setItem("gym-progress", JSON.stringify(newProgress));
          } catch (e) {}
        }, [activeGroupIndex, currentSet, isComplete, currentDay]);

        // Local Storage for Logs and Swaps
        const [logs, setLogs] = useState(() => {
          try {
            const saved = localStorage.getItem("gym-logs");
            return saved ? JSON.parse(saved) : {};
          } catch (e) {
            return {};
          }
        });

        const [swaps, setSwaps] = useState(() => {
          try {
            const saved = localStorage.getItem("gym-swaps");
            return saved ? JSON.parse(saved) : {};
          } catch (e) {
            return {};
          }
        });

        useEffect(() => {
          localStorage.setItem("gym-logs", JSON.stringify(logs));
        }, [logs]);

        useEffect(() => {
          localStorage.setItem("gym-swaps", JSON.stringify(swaps));
        }, [swaps]);

        const [showDaySelector, setShowDaySelector] = useState(false);
        const [showUpcoming, setShowUpcoming] = useState(false);
        const [showDataExport, setShowDataExport] = useState(false);
        const [showMenu, setShowMenu] = useState(false);
        const [travelMode, setTravelMode] = useState(false);
        const [restTimer, setRestTimer] = useState(null); // { endTime: number, duration: number }

        const [celebrate, setCelebrate] = useState(false);
        const [celebrationMessage, setCelebrationMessage] = useState("");

        const dailyRoutine = travelMode
          ? TRAVEL_PLAN
          : WEEKLY_PLAN[currentDay] || [];
        const activeGroup = dailyRoutine[activeGroupIndex];

        const getExerciseId = (originalId) => {
          // Unified swaps: Key is just the exercise ID
          const key = originalId;
          return swaps[key] ? EXERCISE_LIBRARY[originalId].alt : originalId;
        };

        const handleSwap = (originalId) => {
          const key = originalId;
          setSwaps((prev) => ({ ...prev, [key]: !prev[key] }));
        };

        const handleInputChange = (exId, field, value) => {
          // Unified logging: Key is just the exercise ID
          // This ensures Prehab and repeated exercises share data across sets and days
          const key = exId;
          setLogs((prev) => ({
            ...prev,
            [key]: { ...prev[key], [field]: value },
          }));
        };

        const getLog = (exId) => {
          const key = exId;
          return logs[key] || {};
        };

        const triggerCelebration = () => {
          // UPDATED: Now shows summary instead of random message
          setCelebrationMessage(
            `Set ${currentSet} of ${activeGroup.sets} Complete`
          );
          setCelebrate(true);

          // FASTER TIMEOUT: 1000ms
          setTimeout(() => setCelebrate(false), 1000);
        };

        const nextStep = () => {
          triggerCelebration();

          setTimeout(() => {
            // Determine if we should show rest timer
            // Show rest if:
            // 1. Not the very last set of the very last group (workout complete)
            // 2. We are moving to next set OR next group
            const isLastSetOfWorkout =
              activeGroupIndex === dailyRoutine.length - 1 &&
              currentSet === activeGroup.sets;

            if (!isLastSetOfWorkout) {
              // Calculate rest time based on current exercises
              // Take the max rest time of the exercises in the current group
              const currentRestTime = Math.max(
                ...activeGroup.exercises.map((id) => {
                  const ex = EXERCISE_LIBRARY[getExerciseId(id)];
                  return ex.rest || 60;
                })
              );
              setRestTimer(currentRestTime);
            }

            if (currentSet < activeGroup.sets) {
              setCurrentSet((prev) => prev + 1);
            } else {
              if (activeGroupIndex < dailyRoutine.length - 1) {
                setActiveGroupIndex((prev) => prev + 1);
                setCurrentSet(1);
              } else {
                setIsComplete(true);
              }
            }
            window.scrollTo({ top: 0, behavior: "smooth" });
          }, 600); // Slightly faster transition
        };

        const allSets = dailyRoutine.flatMap((group, gIdx) =>
          Array.from({ length: group.sets }).map((_, sIdx) => ({
            groupIndex: gIdx,
            setNumber: sIdx + 1,
            isCompleted:
              gIdx < activeGroupIndex ||
              (gIdx === activeGroupIndex && sIdx + 1 < currentSet),
            isCurrent: gIdx === activeGroupIndex && sIdx + 1 === currentSet,
          }))
        );

        const handleReset = () => {
          if (confirm("Reset progress for " + currentDay + "?")) {
            setActiveGroupIndex(0);
            setCurrentSet(1);
            setIsComplete(false);
          }
        };

        if (isComplete) {
          return (
            <div className="min-h-screen bg-slate-950 text-white flex flex-col items-center justify-center p-8 text-center animate-in zoom-in duration-500 font-sans relative overflow-hidden">
              <div className="absolute top-0 left-0 w-full h-full bg-gradient-to-b from-indigo-900/20 to-slate-950 z-0"></div>
              <div className="absolute top-1/4 left-1/4 w-64 h-64 bg-indigo-500/20 blur-3xl rounded-full animate-pulse"></div>

              <div className="z-10 relative">
                <div className="bg-gradient-to-br from-yellow-400 to-orange-500 w-28 h-28 rounded-3xl flex items-center justify-center mx-auto mb-8 shadow-2xl shadow-orange-500/30 rotate-3 transform hover:rotate-6 transition-transform hover:scale-105 duration-300">
                  <Trophy size={56} className="text-white drop-shadow-md" />
                </div>
                <h1 className="text-5xl font-black mb-4 text-white tracking-tight drop-shadow-lg">
                  Workout Done!
                </h1>
                <p className="text-indigo-200 text-lg mb-10 max-w-xs mx-auto leading-relaxed">
                  Great session. Refuel and recover.
                </p>

                <button
                  onClick={() => {
                    setIsComplete(false);
                    setActiveGroupIndex(0);
                    setCurrentSet(1);
                  }}
                  className="text-slate-400 hover:text-white transition-colors underline decoration-slate-700 underline-offset-4 decoration-2"
                >
                  Start Over
                </button>
              </div>
            </div>
          );
        }

        return (
          <div className="min-h-screen bg-slate-950 text-slate-100 font-sans mx-auto max-w-md flex flex-col relative">
            {restTimer && (
              <RestTimer
                duration={restTimer}
                onComplete={() => setRestTimer(null)}
                onSkip={() => setRestTimer(null)}
              />
            )}

            <UpcomingDrawer
              isOpen={showUpcoming}
              onClose={() => setShowUpcoming(false)}
              dailyRoutine={dailyRoutine}
              activeGroupIndex={activeGroupIndex}
              getExerciseId={getExerciseId}
              logs={logs}
            />

            {showDataExport && (
              <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
                <div
                  className="absolute inset-0 bg-slate-950/80 backdrop-blur-sm animate-in fade-in duration-200"
                  onClick={() => setShowDataExport(false)}
                ></div>
                <div className="bg-slate-900 w-full max-w-lg rounded-2xl border border-white/10 shadow-2xl flex flex-col h-[60vh] relative z-10 animate-in zoom-in-95 duration-200">
                  <div className="p-4 border-b border-white/5 flex justify-between items-center">
                    <h3 className="text-lg font-bold text-white">Local Data</h3>
                    <button
                      onClick={() => setShowDataExport(false)}
                      className="p-2 hover:bg-white/10 rounded-full transition-colors"
                    >
                      <X size={20} />
                    </button>
                  </div>
                  <div className="p-4 flex-1 overflow-hidden flex flex-col gap-4">
                    <p className="text-sm text-slate-400">
                      Copy this data to update your source code defaults.
                    </p>
                    <textarea
                      className="w-full flex-1 bg-slate-950 border border-white/10 rounded-xl p-4 font-mono text-xs text-slate-300 focus:outline-none focus:border-indigo-500 resize-none"
                      readOnly
                      value={JSON.stringify(logs, null, 2)}
                      onClick={(e) => e.target.select()}
                    />
                  </div>
                </div>
              </div>
            )}

            {celebrate && (
              <div className="fixed inset-0 z-[100] flex items-center justify-center pointer-events-none">
                <div className="absolute inset-0 bg-indigo-950/60 backdrop-blur-sm animate-in fade-in duration-200"></div>
                <div className="bg-gradient-to-br from-indigo-600 to-violet-600 px-10 py-8 rounded-[2rem] border-4 border-white/10 shadow-[0_0_50px_rgba(79,70,229,0.5)] animate-in zoom-in-50 duration-200 slide-in-from-bottom-10 transform scale-110">
                  <h2 className="text-3xl font-black text-white drop-shadow-[0_2px_4px_rgba(0,0,0,0.3)] flex flex-col items-center gap-4 italic transform -rotate-1 text-center leading-none">
                    <div className="bg-white/20 p-4 rounded-full animate-bounce">
                      <Check
                        className="text-emerald-400 w-12 h-12"
                        strokeWidth={4}
                      />
                    </div>
                    <span className="uppercase tracking-tighter text-xl mt-2">
                      {celebrationMessage}
                    </span>
                  </h2>
                </div>
              </div>
            )}

            <header className="bg-slate-900/80 backdrop-blur-xl border-b border-white/5 sticky top-0 z-50">
              <div className="p-5 pb-2 flex justify-between items-center">
                <div className="relative">
                  <button
                    onClick={() => setShowDaySelector(!showDaySelector)}
                    className="flex items-center gap-2 text-2xl font-black text-white tracking-tight hover:text-indigo-400 transition-colors active:scale-95"
                  >
                    {currentDay}{" "}
                    <ChevronRight
                      className={`transition-transform text-indigo-500 ${
                        showDaySelector ? "rotate-90" : ""
                      }`}
                      size={20}
                      strokeWidth={3}
                    />
                  </button>
                  {showDaySelector && (
                    <div className="absolute top-full left-0 mt-3 bg-slate-800 border border-slate-700 rounded-2xl shadow-2xl py-2 w-56 z-50 max-h-80 overflow-y-auto animate-in fade-in zoom-in-95 duration-200">
                      {Object.keys(WEEKLY_PLAN).map((day) => (
                        <button
                          key={day}
                          onClick={() => {
                            setCurrentDay(day);
                            setShowDaySelector(false);
                          }}
                          className={`block w-full text-left px-5 py-3 hover:bg-slate-700/50 transition-colors ${
                            currentDay === day
                              ? "text-indigo-400 font-bold bg-slate-700/30"
                              : "text-slate-400 font-medium"
                          }`}
                        >
                          {day}
                        </button>
                      ))}
                    </div>
                  )}
                </div>
                <div className="flex items-center gap-2">
                  <button
                    onClick={() => setShowUpcoming(true)}
                    className="p-2 rounded-full bg-slate-800/50 text-slate-400 hover:text-white hover:bg-indigo-600 transition-all active:scale-90"
                    title="Upcoming Exercises"
                  >
                    <Calendar size={20} />
                  </button>
                  <button
                    onClick={handleReset}
                    className="p-2 rounded-full bg-slate-800/50 text-slate-400 hover:text-white hover:bg-indigo-600 transition-all active:scale-90"
                    title="Reset Progress"
                  >
                    <RotateCcw size={20} />
                  </button>
                  <div className="relative">
                    <button
                      onClick={() => setShowMenu(!showMenu)}
                      className="p-2 rounded-full bg-slate-800/50 text-slate-400 hover:text-white hover:bg-indigo-600 transition-all active:scale-90"
                      title="Menu"
                    >
                      <MoreVertical size={20} />
                    </button>
                    {showMenu && (
                      <div className="absolute top-full right-0 mt-3 bg-slate-800 border border-slate-700 rounded-2xl shadow-2xl py-2 w-56 z-50 animate-in fade-in zoom-in-95 duration-200">
                        <button
                          onClick={() => {
                            setTravelMode(!travelMode);
                            setShowMenu(false);
                          }}
                          className="w-full text-left px-5 py-3 hover:bg-slate-700/50 transition-colors flex items-center justify-between group"
                        >
                          <span className="text-slate-300 font-medium group-hover:text-white flex items-center gap-2">
                            <Plane size={16} /> Travel Mode
                          </span>
                          <div
                            className={`w-10 h-5 rounded-full relative transition-colors ${
                              travelMode ? "bg-indigo-500" : "bg-slate-600"
                            }`}
                          >
                            <div
                              className={`absolute top-1 left-1 w-3 h-3 bg-white rounded-full transition-transform ${
                                travelMode ? "translate-x-5" : "translate-x-0"
                              }`}
                            />
                          </div>
                        </button>
                        <button
                          onClick={() => {
                            setShowDataExport(true);
                            setShowMenu(false);
                          }}
                          className="w-full text-left px-5 py-3 hover:bg-slate-700/50 transition-colors text-slate-300 font-medium hover:text-white"
                        >
                          Export Data
                        </button>
                      </div>
                    )}
                  </div>
                </div>
              </div>

              <div className="px-5 pb-5 pt-1 flex flex-wrap gap-1.5">
                {allSets.map((set, idx) => (
                  <div
                    key={idx}
                    className={`h-2.5 flex-1 rounded-full transition-all duration-500 ${
                      set.isCompleted
                        ? "bg-emerald-400 shadow-[0_0_10px_rgba(52,211,153,0.5)] scale-100"
                        : set.isCurrent
                        ? "bg-indigo-500 animate-pulse w-[1.5] scale-110 shadow-[0_0_10px_rgba(99,102,241,0.6)]"
                        : "bg-slate-800 scale-95"
                    } ${
                      idx > 0 && set.groupIndex !== allSets[idx - 1].groupIndex
                        ? "ml-2"
                        : ""
                    }`}
                  />
                ))}
              </div>
            </header>

            <main className="flex-1 p-5 flex flex-col gap-6 pb-40">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-2 text-indigo-300 bg-indigo-900/20 px-3 py-1 rounded-full border border-indigo-500/20">
                  <Activity size={14} />
                  <span className="text-xs font-bold uppercase tracking-wider">
                    Pair {activeGroupIndex + 1} / {dailyRoutine.length}
                  </span>
                </div>
                <span className="text-sm font-black text-white">
                  Set {currentSet}{" "}
                  <span className="text-slate-500 font-medium">
                    / {activeGroup.sets}
                  </span>
                </span>
              </div>

              <div className="flex flex-col gap-8 relative">
                <div className="absolute left-1/2 top-10 bottom-10 w-0.5 bg-gradient-to-b from-slate-800 via-indigo-900/50 to-slate-800 -translate-x-1/2 rounded-full"></div>

                {activeGroup ? (
                  activeGroup.exercises.map((originalId) => {
                    const effectiveId = getExerciseId(originalId);
                    const isSwapped = swaps[originalId];

                    return (
                      <ExerciseCard
                        key={originalId}
                        exerciseId={effectiveId}
                        isSwapped={isSwapped}
                        onSwap={() => handleSwap(originalId)}
                        onInputChange={handleInputChange}
                        logData={getLog(effectiveId)}
                        isComplete={false}
                      />
                    );
                  })
                ) : (
                  <div className="text-center text-slate-500">Rest Day</div>
                )}
              </div>
            </main>

            <footer className="fixed bottom-0 left-0 right-0 p-5 bg-gradient-to-t from-slate-950 via-slate-950/95 to-transparent z-40 max-w-md mx-auto">
              <button
                onClick={nextStep}
                className="w-full bg-indigo-600 hover:bg-indigo-500 active:scale-[0.97] active:bg-indigo-700 text-white font-black py-4 rounded-2xl shadow-[0_10px_30px_rgba(79,70,229,0.3)] flex items-center justify-center gap-3 transition-all duration-200 group border-t border-white/10"
              >
                <span className="text-lg tracking-wide">
                  {currentSet < activeGroup.sets
                    ? "Finish Set"
                    : "Complete Pair"}
                </span>
                <div className="bg-indigo-700 rounded-lg p-1 group-hover:bg-indigo-600 transition-colors group-hover:translate-x-1 duration-300">
                  <ChevronRight size={18} strokeWidth={3} />
                </div>
              </button>
            </footer>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<ClimberGymGuide />);
    </script>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker.register("gym-sw.js").then(
            (registration) => {
              console.log(
                "ServiceWorker registration successful with scope: ",
                registration.scope
              );
            },
            (err) => {
              console.log("ServiceWorker registration failed: ", err);
            }
          );
        });
      }
    </script>
  </body>
</html>
